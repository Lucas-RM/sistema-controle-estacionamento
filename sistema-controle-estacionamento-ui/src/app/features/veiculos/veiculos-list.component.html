<div class="container-fluid">
  <div class="row">
    <div class="col-md-12">
      <h2><i class="fa fa-car"></i> Cadastro de Veículos</h2>
      <p class="text-muted">Gerenciar veículos cadastrados no sistema</p>
    </div>
  </div>

  <div class="row">
    <div class="col-md-6">
      <div class="form-group">
        <div class="input-group">
          <input type="text" class="form-control" placeholder="Buscar por placa..." 
                 [(ngModel)]="filtroPlaca" (keyup.enter)="buscar()">
          <span class="input-group-btn">
            <button class="btn btn-primary" type="button" (click)="buscar()">
              <i class="fa fa-search"></i> Buscar
            </button>
          </span>
        </div>
      </div>
    </div>
    <div class="col-md-6 text-right">
      <button class="btn btn-success" (click)="abrirModalNovo()">
        <i class="fa fa-plus"></i> Novo Veículo
      </button>
    </div>
  </div>

  <div *ngIf="loading" class="text-center">
    <i class="fa fa-spinner fa-spin fa-3x"></i>
    <p>Carregando...</p>
  </div>

  <div *ngIf="!loading && veiculos.length === 0" class="alert alert-info">
    <i class="fa fa-info-circle"></i> Nenhum veículo cadastrado.
  </div>

  <div *ngIf="!loading && veiculos.length > 0" class="table-responsive">
    <table class="table table-striped table-hover">
      <thead>
        <tr>
          <th>Placa</th>
          <th>Modelo</th>
          <th>Cor</th>
          <th>Tipo</th>
          <th>Cadastrado em</th>
          <th class="text-right">Ações</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let veiculo of veiculos">
          <td><strong>{{ veiculo.placa | placaFormat }}</strong></td>
          <td>{{ veiculo.modelo || 'N/A' }}</td>
          <td>{{ veiculo.cor || 'N/A' }}</td>
          <td>{{ veiculo.tipo }}</td>
          <td>{{ veiculo.createdAt | date:'dd/MM/yyyy HH:mm' }}</td>
          <td class="text-right">
            <button class="btn btn-sm btn-primary" (click)="abrirModalEditar(veiculo)">
              <i class="fa fa-edit"></i> Editar
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>

<!-- Modal Formulário -->
<p-dialog [header]="editando ? 'Editar Veículo' : 'Novo Veículo'" 
          [(visible)]="mostrarModal" [modal]="true" [responsive]="true" [width]="500">
  <form [formGroup]="veiculoForm">
    <div class="form-group">
      <label>Placa *</label>
      <input type="text" class="form-control" formControlName="placa" 
             placeholder="ABC1234" [class.has-error]="veiculoForm.get('placa') && veiculoForm.get('placa').invalid && veiculoForm.get('placa').touched">
      <small class="text-danger" *ngIf="veiculoForm.get('placa') && veiculoForm.get('placa').invalid && veiculoForm.get('placa').touched">
        Formato inválido (ex: ABC1234, ABC1D23)
      </small>
    </div>
    
    <div class="form-group">
      <label>Modelo</label>
      <input type="text" class="form-control" formControlName="modelo" placeholder="Honda Civic">
    </div>
    
    <div class="form-group">
      <label>Cor</label>
      <input type="text" class="form-control" formControlName="cor" placeholder="Preto">
    </div>
    
    <div class="form-group">
      <label>Tipo *</label>
      <select class="form-control" formControlName="tipo">
        <option *ngFor="let tipo of tiposVeiculo" [value]="tipo.value">
          {{ tipo.label }}
        </option>
      </select>
    </div>
  </form>
  
  <p-footer>
    <button type="button" class="btn btn-default" (click)="cancelar()">
      <i class="fa fa-times"></i> Cancelar
    </button>
    <button type="button" class="btn btn-success" (click)="salvar()" 
            [disabled]="veiculoForm.invalid || loading">
      <i class="fa fa-check"></i> Salvar
    </button>
  </p-footer>
</p-dialog>
